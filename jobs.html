<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jobs â€“ Career Unified</title>

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jobs.css">

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #f5f5f7;
  color: #111827;
  overflow-x: hidden;
}

.main-nav {
  padding: 14px 30px;
  display: flex;
  justify-content: space-between;
  background: #1e3a8a;
}

.main-nav .logo,
.main-nav .nav-links a {
  color: white;
  text-decoration: none;
  font-weight: 600;
}

header {
  text-align: center;
  padding: 70px 15px 55px;
  background: linear-gradient(90deg, #1e3a8a, #2563eb);
  color: #fff;
}

.jobs-container {
  display: flex;
  max-width: 1200px;
  margin: 30px auto;
  gap: 20px;
}

.jobs-left { flex: 1; }
.jobs-preview {
  flex: 1;
  background: white;
  border-radius: 10px;
  padding: 20px;
  min-height: 420px;
}

.job-card {
  background: white;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
  cursor: pointer;
  position: relative;
}

.job-card.selected {
  border-left: 4px solid #facc15;
}

.job-badge {
  position: absolute;
  top: 10px;
  right: 12px;
  background: #facc15;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
}

.apply-btn {
  display: inline-block;
  margin-top: 15px;
  background: #16a34a;
  color: white;
  padding: 8px 14px;
  border-radius: 6px;
  text-decoration: none;
}

.fade-in {
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<!-- NAV -->
<nav class="main-nav">
  <a href="index.html" class="logo">Career Unified</a>
  <div class="nav-links">
    <a href="jobs.html">Jobs</a>
    <a href="bursaries.html">Bursaries</a>
    <a href="varsity.html">Varsity</a>
    <a href="cv-generator.html">Generate CV</a>
    <a href="login.html">Login</a>
  </div>
</nav>

<header>
  <h1>Available Jobs</h1>
  <p>Find your next opportunity</p>
</header>

<main class="jobs-container">
  <div class="jobs-left">
    <input id="jobSearch" placeholder="Search jobs..." />
    <select id="categoryFilter">
      <option value="all">All</option>
      <option value="internship">Internship</option>
      <option value="temporary">Temporary</option>
      <option value="freelance">Freelance</option>
    </select>
    <button id="sortBtn">Sort</button>
    <ul id="jobList"></ul>
  </div>

  <div class="jobs-preview" id="jobPreview">
    <p>Select a job to view details</p>
  </div>
</main>

<!-- FIREBASE LOGIN STATE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAEBbnXPlYYf9jbfgLSzfod3r0i5MOAo9M",
  authDomain: "career-unified.firebaseapp.com",
  projectId: "career-unified",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

window.currentUser = null;
onAuthStateChanged(auth, user => {
  window.currentUser = user;
  console.log("Auth state:", user ? "Logged in" : "Logged out");
});
</script>

<!-- SANITY CLIENT -->
<script src="js/sanityClient.js"></script>

<!-- JOB LOGIC -->
<script>
console.log("Jobs page loaded");

const jobList = document.getElementById('jobList');
const jobPreview = document.getElementById('jobPreview');

let jobs = [];
let selectedIndex = null;

async function fetchJobs() {
  try {
    jobs = await window.sanityClient.fetch(`
      *[_type=="job"] | order(deadline asc){
        title, company, description, location, salary,
        applyLink, posted, deadline, category,
        isSponsored, isPremier, sponsoredUntil, badge
      }
    `);
    console.log("Jobs fetched:", jobs.length);
    renderJobs();
  } catch (err) {
    console.error("Fetch jobs failed:", err);
  }
}

function renderJobs() {
  if (!Array.isArray(jobs)) {
    console.warn("Jobs is not an array");
    return;
  }

  const today = new Date();
  jobList.innerHTML = '';

  jobs.forEach((job, index) => {
    const li = document.createElement('li');
    li.className = 'job-card';
    if (index === selectedIndex) li.classList.add('selected');

    let badgeText = '';
    if (job.badge) badgeText = job.badge;
    else if (job.isPremier && new Date(job.sponsoredUntil) >= today) badgeText = 'Premier';
    else if (job.isSponsored && new Date(job.sponsoredUntil) >= today) badgeText = 'Sponsored';

    li.innerHTML = `
      <h3>${job.title}</h3>
      <p>${job.company}</p>
      ${badgeText ? `<span class="job-badge">${badgeText}</span>` : ''}
    `;

    li.onclick = () => {
      selectedIndex = index;
      showPreview(job);
      renderJobs();
    };

    jobList.appendChild(li);
  });
}

function showPreview(job) {
  const applyButton = window.currentUser
    ? `<a class="apply-btn" href="${job.applyLink}" target="_blank">Apply Now</a>`
    : `<a class="apply-btn" href="login.html">Login to Apply</a>`;

  jobPreview.innerHTML = `
    <div class="fade-in">
      <h2>${job.title}</h2>
      <p>${job.company}</p>
      <p>${job.location}</p>
      <p>${job.description}</p>
      ${applyButton}
    </div>
  `;
}

fetchJobs();
</script>

</body>
</html>




































