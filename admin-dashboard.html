<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin Dashboard ‚Äì Recruiter Approvals</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    query,
    where,
    getDocs,
    doc,
    updateDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîê Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAEBbnXPlYYf9jbfgLSzfod3r0i5MOAo9M",
    authDomain: "career-unified.firebaseapp.com",
    projectId: "career-unified",
    storageBucket: "career-unified.firebasestorage.app",
    messagingSenderId: "101656817742",
    appId: "1:101656817742:web:22c9a58a822a714e54931f"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  // üîπ List of admin UIDs (add as many as you need)
  const ADMIN_UIDS = [
    "X3eReX1WGpQSR1svO4JIBFDqFUJ3", // YOUR ACCOUNT
    // Add more UIDs if needed
  ];

  // üîπ Check if current user is admin
  function isAdmin(user) {
    return user && ADMIN_UIDS.includes(user.uid);
  }

  // üîπ Load pending applications
  async function loadApplications() {
    const q = query(
      collection(db, "recruiterApplications"),
      where("status", "==", "pending")
    );

    const snapshot = await getDocs(q);
    const container = document.getElementById("applications");
    container.innerHTML = "";

    if (snapshot.empty) {
      container.innerHTML = "<p>No pending applications.</p>";
      return;
    }

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const div = document.createElement("div");
      div.style.marginBottom = "20px";
      div.innerHTML = `
        <strong>${data.companyName}</strong><br>
        Website: ${data.companyWebsite}<br>
        Reason: ${data.reason}<br>
        User ID: ${data.userId}<br><br>
        <button onclick="approve('${docSnap.id}', '${data.userId}')">Approve</button>
        <button onclick="reject('${docSnap.id}')">Reject</button>
        <hr>
      `;
      container.appendChild(div);
    });
  }

  // üîπ Approve application
  window.approve = async (applicationId, userId) => {
    try {
      await updateDoc(doc(db, "recruiterApplications", applicationId), {
        status: "approved",
        reviewedAt: serverTimestamp()
      });
      await updateDoc(doc(db, "users", userId), {
        recruiterStatus: "approved"
      });
      alert("Recruiter approved");
      loadApplications();
    } catch (err) {
      console.error(err);
      alert("Error approving application");
    }
  };

  // üîπ Reject application
  window.reject = async (applicationId) => {
    try {
      await updateDoc(doc(db, "recruiterApplications", applicationId), {
        status: "rejected",
        reviewedAt: serverTimestamp()
      });
      alert("Recruiter rejected");
      loadApplications();
    } catch (err) {
      console.error(err);
      alert("Error rejecting application");
    }
  };

  // üîπ Auth state check
  onAuthStateChanged(auth, user => {
    console.log("Logged in UID:", user?.uid);
    if (!isAdmin(user)) {
      alert("Access denied. Admins only.");
      window.location.href = "index.html";
      return;
    }
    currentUser = user;
    loadApplications();
  });
</script>

<style>
  body { font-family: Arial, sans-serif; padding: 30px; background: #f9f9f9; }
  h1 { text-align: center; margin-bottom: 30px; }
  button { margin-right: 10px; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { opacity: 0.8; }
  button:first-of-type { background-color: #16a34a; color: white; }
  button:last-of-type { background-color: #dc2626; color: white; }
  hr { margin-top: 15px; margin-bottom: 15px; }
</style>
</head>

<body>
  <h1>Admin ‚Äì Recruiter Applications</h1>
  <div id="applications">Loading...</div>
</body>
</html>

